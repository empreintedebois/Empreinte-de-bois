I8<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Empreinte de Bois – Portfolio 3D</title>
  <meta name="description" content="Portfolio 3D et gravure numérique : sélection de projets, démarche, matériaux et contact." />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Fond animé global (fixe, derrière tout) -->
  <canvas id="background-canvas" aria-hidden="true"></canvas>

  <!-- HEADER STICKY -->
  <header class="site-header" id="site-header">
    <div class="shell shell--row">
      <a href="#top" class="site-logo">
        <span class="site-logo__mark">EB</span>
        <span class="site-logo__text">Empreinte de Bois</span>
      </a>

      <nav class="site-nav" aria-label="Navigation principale">
        <a href="#portfolio">Galerie</a>
        <a href="#process">Démarche</a>
        <a href="#models">Modèles</a>
        <a href="#about">À propos</a>
        <a href="#contact">Contact</a>
      </nav>
    </div>
  </header>

  <main id="top">
    <!-- HERO SECTION -->
    <section class="hero" aria-labelledby="hero-title">
      <div class="hero__bg"></div>
      <div class="shell hero__content">
        <div class="hero__text">
          <p class="eyebrow">Conception 3D &amp; gravure</p>
          <h1 id="hero-title">Donner du relief à la matière.</h1>
          <p class="hero__subtitle">
            Images, volumes et textures au service de la fabrication. Un pont entre rendu numérique et pièce physique.
          </p>

          <div class="hero__actions">
            <a href="#portfolio" class="btn btn--primary">Voir la galerie</a>
            <a href="#contact" class="btn btn--ghost">Discuter d’un projet</a>
          </div>

          <p class="hero__hint">Scroll pour explorer la galerie ↓</p>
        </div>

        <div class="hero__preview">
          <div class="hero-card">
            <img
              src="assets/bandeaux/M05/image.png"
              alt="Carré Bois Sapin — support en bois"
              loading="lazy"
            />
            <div class="hero-card__meta">
              <p class="hero-card__tag">Carré Bois</p>
              <p class="hero-card__title">Support en bois massif</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- GALERIE SECTION -->
    <section class="section" id="portfolio" aria-labelledby="portfolio-title">
      <div class="shell">
        <div class="section__hdr">
          <h2 id="portfolio-title">Galerie</h2>
          <p>Une sélection de projets récents&nbsp;: matières, essais de lumière, compositions et maquettes préparatoires.</p>
        </div>

        <div class="gallery-filters" role="tablist" aria-label="Filtres galerie">
          <button class="chip is-active" data-filter="all" role="tab" aria-selected="true">Tout</button>
          <button class="chip" data-filter="gravure" role="tab">Gravure</button>
          <button class="chip" data-filter="volume" role="tab">Volumes</button>
          <button class="chip" data-filter="proto" role="tab">Maquettes</button>
          <button class="chip" data-filter="volume proto" role="tab">Volumes &amp; prototypes</button>
        </div>

        <div class="gallery-grid">
          <article class="gallery-item" data-cat="gravure">
            <button class="gallery-item__btn" type="button" data-full="assets/galerie/galerie01_w1280.webp">
              <div class="gallery-item__media">
                <img src="assets/galerie/galerie01_w640.webp" alt="Gravure ronde aux motifs floraux" loading="lazy" decoding="async" />
              </div>
              <div class="gallery-item__meta">
                <h3>Motifs floraux</h3>
                <p>Gravure ronde finement ciselée sur bois.</p>
              </div>
            </button>
          </article>

          <article class="gallery-item" data-cat="volume">
            <button class="gallery-item__btn" type="button" data-full="assets/bandeaux/M05/image.png">
              <div class="gallery-item__media">
                <img src="assets/bandeaux/M05/image.png" alt="Carré Bois Sapin — support en bois" loading="lazy" decoding="async" />
              </div>
              <div class="gallery-item__meta">
                <h3>Carré Bois Sapin</h3>
                <p>Support en bois massif au grain fin.</p>
              </div>
            </button>
          </article>

          <article class="gallery-item" data-cat="volume">
            <button class="gallery-item__btn" type="button" data-full="assets/bandeaux/M06/image.png">
              <div class="gallery-item__media">
                <img src="assets/bandeaux/M06/image.png" alt="Carré Bois Noyer — support en bois foncé" loading="lazy" decoding="async" />
              </div>
              <div class="gallery-item__meta">
                <h3>Carré Bois Noyer</h3>
                <p>Support en noyer aux teintes chaudes.</p>
              </div>
            </button>
          </article>

          <article class="gallery-item" data-cat="proto">
            <button class="gallery-item__btn" type="button" data-full="assets/bandeaux/M01/image.png">
              <div class="gallery-item__media">
                <img src="assets/bandeaux/M01/image.png" alt="Rond Sapin — disque en bois" loading="lazy" decoding="async" />
              </div>
              <div class="gallery-item__meta">
                <h3>Rond Sapin</h3>
                <p>Disque en sapin avec bord arrondi.</p>
              </div>
            </button>
          </article>

          <article class="gallery-item" data-cat="volume proto">
            <button class="gallery-item__btn" type="button" data-full="assets/bandeaux/M03/image.png">
              <div class="gallery-item__media">
                <img src="assets/bandeaux/M03/image.png" alt="Rond Similicuir blanc — disque en simili cuir" loading="lazy" decoding="async" />
              </div>
              <div class="gallery-item__meta">
                <h3>Rond Similicuir blanc</h3>
                <p>Disque en similicuir doux et résistant.</p>
              </div>
            </button>
          </article>
        </div>
      </div>
    </section>

    <!-- PROCESS SECTION -->
    <section class="section section--alt" id="process" aria-labelledby="process-title">
      <div class="shell">
        <div class="section__hdr">
          <h2 id="process-title">Démarche</h2>
          <p>Une boucle courte entre idée, simulation 3D et test matière.</p>
        </div>

        <div class="process-grid">
          <article class="process-card">
            <h3>1. Intention &amp; contraintes</h3>
            <p>On clarifie le contexte&nbsp;: support, format, budget, contraintes d’atelier. L’idée, c’est d’avoir un cadre solide avant de pousser les images.</p>
          </article>
          <article class="process-card">
            <h3>2. Études 3D &amp; lumière</h3>
            <p>Travail en 3D sur volumes, textures, contrastes et lisibilité. Les rendus servent ensuite de base à la gravure ou à la fabrication.</p>
          </article>
          <article class="process-card">
            <h3>3. Passage matière</h3>
            <p>Tests sur bois ou autres matériaux, ajustement des profondeurs de gravure, des densités et des zones de réserve.</p>
          </article>
          <article class="process-card">
            <h3>4. Finitions &amp; variations</h3>
            <p>Déclinaisons de la même base&nbsp;: formats, intensité des contrastes, colorisation partielle ou séries limitées.</p>
          </article>
        </div>
      </div>
    </section>

    <!-- MODÈLES & DÉCLINAISONS -->
    <section class="section" id="models" aria-labelledby="models-title">
      <div class="shell">
        <div class="section__hdr">
          <h2 id="models-title">Modèles &amp; déclinaisons</h2>
          <p>Choisissez un support et explorez ses variantes de matière ou de couleur.</p>
        </div>
        <div class="models-wrapper">
          <aside class="models-list" aria-label="Liste des modèles"></aside>

          <div class="model-preview" aria-live="polite">
            <div class="model-main">
              <img src="" alt="" />
            </div>
            <div class="model-info">
              <h3></h3>
              <p></p>
            </div>
            <div class="model-variants" aria-label="Variantes"></div>
            <button class="add-selection btn btn--primary" type="button">Ajouter à ma sélection</button>
          </div>
        </div>
      </div>
    </section>

    <!-- À PROPOS -->
    <section class="section" id="about" aria-labelledby="about-title">
      <div class="shell about">
        <div class="about__text">
          <h2 id="about-title">À propos</h2>
          <p>Je conçois des images et des volumes destinés à devenir des objets physiques&nbsp;: gravures, panneaux, pièces uniques ou petites séries.</p>
          <p>Mon travail mélange outils 3D, sens de la matière et contraintes réelles d’atelier. L’objectif&nbsp;: garder un rendu fort, mais fabriquable.</p>
        </div>
        <ul class="about__tags" aria-label="Champs de travail">
          <li>Conception 3D</li>
          <li>Préparation gravure</li>
          <li>Études lumière</li>
          <li>Matériaux &amp; textures</li>
        </ul>
      </div>
    </section>

    <!-- CONTACT -->
    <section class="section section--alt" id="contact" aria-labelledby="contact-title">
      <div class="shell contact">
        <div class="contact__text">
          <h2 id="contact-title">Contact</h2>
          <p>Un projet, une idée ou juste une question sur la faisabilité d’une pièce&nbsp;? Envoyez quelques lignes, éventuellement des visuels, et on voit ce qui est réaliste.</p>
        </div>

        <form class="contact__form" action="mailto:empreinte.de.bois@example.com" method="post">
          <label>
            Nom
            <input type="text" name="name" autocomplete="name" required />
          </label>
          <label>
            Email
            <input type="email" name="email" autocomplete="email" required />
          </label>
          <label>
            Message
            <textarea name="message" rows="5" required></textarea>
          </label>
          <label>
            Sélection
            <textarea id="selection-summary" name="selection" rows="3" readonly></textarea>
          </label>
          <button type="submit" class="btn btn--primary">Envoyer</button>
        </form>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="shell site-footer__inner">
      <p>© Empreinte de Bois – Adam</p>
      <div class="site-footer__links">
        <a href="#top">Retour en haut</a>
      </div>
    </div>
  </footer>

  <!-- Lightbox modal for gallery -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <button class="lightbox__backdrop" data-close="1" aria-label="Fermer"></button>
    <figure class="lightbox__body">
      <img src="" alt="" id="lightbox-img" />
      <figcaption id="lightbox-caption"></figcaption>
      <button class="lightbox__close" data-close="1" aria-label="Fermer la vue détaillée">×</button>
    </figure>
  </div>

  <script src="page.js" defer></script>

  <!-- SCRIPT FOND ANIMÉ (cover, non répété, fixe) -->
  <script>
  // ===============================
  // PARAMÈTRES (à modifier)
  // ===============================
  const IMG_GREY_V = "assets/fond/fond-gris-v.webp";
  const IMG_GOLD_V = "assets/fond/fond-dore-v.webp";

  const IMG_GREY_H = "assets/fond/fond-gris-h.webp";
  const IMG_GOLD_H = "assets/fond/fond-dore-h.webp";

  const MAX_COVER_SCALE = 1.15;

  // Halos en ratio (relatifs à l'écran)
  const MIN_DIAMETER_RATIO = 0.06;
  const MAX_DIAMETER_RATIO = 0.18;

  // Timings (ms)
  const FADE_IN  = 3000;
  const FADE_OUT = 800;
  const SPAWN_DELAY = 800;

  // Profil du halo (0.35 = bord plus net / 0.75 = très diffus)
  const SOFT_EDGE = 0.55;

  // Densité / perf
  const MAX_PULSES = 20;
  const MAX_PULSES_PER_SPAWN = 3;

  // Perf (mobile)
  const MAX_DPR = 1.5;

  // Anti "micro-zoom" Android/Chrome
  const VIEWPORT_HYSTERESIS_PX = 150;
  // ===============================

  const canvas = document.getElementById("background-canvas");
  const ctx = canvas.getContext("2d");

  const maskCanvas = document.createElement("canvas");
  const maskCtx = maskCanvas.getContext("2d");

  const goldCanvas = document.createElement("canvas");
  const goldCtx = goldCanvas.getContext("2d");

  let w = 0, h = 0, dpr = 1;
  let pulses = [];
  let lastSpawn = 0;

  function resize() {
    dpr = Math.min(window.devicePixelRatio || 1, MAX_DPR);

    const vv = window.visualViewport;
    const newW = Math.round(vv ? vv.width : window.innerWidth);
    const newH = Math.round(vv ? vv.height : window.innerHeight);
    // Android/Chrome : la barre d’adresse fait varier innerHeight au scroll
    // -> on ignore si c’est un petit delta, pour éviter le “zoom”
    if (w && newW === w && Math.abs(newH - h) < VIEWPORT_HYSTERESIS_PX) return;

    w = newW;
    h = newH;

    for (const c of [canvas, maskCanvas, goldCanvas]) {
      c.width = Math.floor(w * dpr);
      c.height = Math.floor(h * dpr);
    }

    canvas.style.width = w + "px";
    canvas.style.height = h + "px";

    ctx.setTransform(dpr,0,0,dpr,0,0);
    maskCtx.setTransform(dpr,0,0,dpr,0,0);
    goldCtx.setTransform(dpr,0,0,dpr,0,0);
  }

  function load(src) {
    return new Promise((resolve, reject) => {
      const i = new Image();
      i.onload = () => resolve(i);
      i.onerror = () => reject(new Error("Image introuvable: " + src));
      i.src = src;
    });
  }

  function pickBackgroundByOrientation() {
    const isPortrait = window.matchMedia("(orientation: portrait)").matches;
    return isPortrait
      ? { grey: IMG_GREY_V, gold: IMG_GOLD_V }
      : { grey: IMG_GREY_H, gold: IMG_GOLD_H };
  }

  function drawCover(ctx2d, img) {
    const iw = img.width, ih = img.height;
    const rawScale = Math.max(w / iw, h / ih);
    const scale = Math.min(rawScale, MAX_COVER_SCALE);
    const dw = iw * scale;
    const dh = ih * scale;
    const dx = (w - dw) / 2;
    const dy = (h - dh) / 2;
    ctx2d.drawImage(img, dx, dy, dw, dh);
  }

  function spawn(now) {
    if (pulses.length >= MAX_PULSES) return;

    // 1 → MAX_PULSES_PER_SPAWN halos (apparitions groupées)
    const count = 1 + Math.floor(Math.random() * MAX_PULSES_PER_SPAWN);

    const base = Math.min(w, h);
    const minD = base * MIN_DIAMETER_RATIO;
    const maxD = base * MAX_DIAMETER_RATIO;

    for (let i = 0; i < count; i++) {
      if (pulses.length >= MAX_PULSES) break;

      const d = minD + Math.random() * (maxD - minD);

      pulses.push({
        x: Math.random() * w,
        y: Math.random() * h,
        r: d / 2,
        born: now + Math.random() * 250,                 // désynchronise un peu le cluster
        die:  now + FADE_IN + FADE_OUT + 250
      });
    }
  }

  function opacity(p, now) {
    const t = now - p.born;
    if (t < 0) return 0;
    if (t < FADE_IN) return t / FADE_IN;
    if (t < FADE_IN + FADE_OUT) return 1 - (t - FADE_IN) / FADE_OUT;
    return 0;
  }

  (async function () {
    let grey, gold;

    try {
      const picked = pickBackgroundByOrientation();
      [grey, gold] = await Promise.all([load(picked.grey), load(picked.gold)]);
    } catch (e) {
      console.error("[Fond animé]", e);
      return;
    }

    resize();
    window.addEventListener("resize", resize, { passive: true });

    window.addEventListener("orientationchange", async () => {
      try {
        const picked = pickBackgroundByOrientation();
        [grey, gold] = await Promise.all([load(picked.grey), load(picked.gold)]);
        resize();
      } catch (e) {
        console.error("[Fond animé] reload orientation", e);
      }
    }, { passive: true });

    function frame(now) {
      if (now - lastSpawn > SPAWN_DELAY) {
        spawn(now);
        lastSpawn = now;
      }

      pulses = pulses.filter(p => now < p.die);

      // base gris
      ctx.clearRect(0,0,w,h);
      drawCover(ctx, grey);

      // couche dorée
      goldCtx.clearRect(0,0,w,h);
      drawCover(goldCtx, gold);

      // masque radial
      maskCtx.clearRect(0,0,w,h);
      for (const p of pulses) {
        const a = opacity(p, now);
        if (!a) continue;

        const g = maskCtx.createRadialGradient(
          p.x, p.y, p.r * (1 - SOFT_EDGE),
          p.x, p.y, p.r
        );
        g.addColorStop(0, `rgba(255,255,255,${a})`);
        g.addColorStop(1, "rgba(255,255,255,0)");

        maskCtx.fillStyle = g;
        maskCtx.beginPath();
        maskCtx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        maskCtx.fill();
      }

      goldCtx.globalCompositeOperation = "destination-in";
      goldCtx.drawImage(maskCanvas, 0, 0, w, h);
      goldCtx.globalCompositeOperation = "source-over";

      ctx.drawImage(goldCanvas, 0, 0, w, h);

      requestAnimationFrame(frame);
    }

    requestAnimationFrame(frame);
  })();
  </script>
</body>
</html>
