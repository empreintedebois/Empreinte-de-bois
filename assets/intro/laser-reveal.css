/* ============================================================
   Laser Reveal (scan + crépitements + rideau de particules)

   Notes :
   - Pour les IMG/éléments avec transparence : mask-image = alpha
   - Pour du HTML (texte/div) : masque = box (rectangle)
   - Le fond est exclu par design : n'applique pas .scan-reveal au fond.
   ============================================================ */

/* Pendant le reveal on cache les éléments ciblés (pas le fond) */
body.laser-reveal-running .scan-reveal{
  opacity: 0;
}

/* Élément concerné */
.scan-reveal{
  position: relative;
  opacity: var(--reveal, 1);
  transition: opacity 120ms linear;
}

/* Couche FX */
.scan-reveal::before{
  content: "";
  position: absolute;
  inset: -8px;
  pointer-events: none;
  opacity: calc(var(--fx, 0) * var(--flicker, 1));
  transform: translateZ(0);

  background-image:
    /* ligne principale */
    radial-gradient(ellipse 120% 10px at 50% var(--localY, -999px),
      rgba(255,255,255,0.0) 0px,
      rgba(255,255,255,0.95) 2px,
      rgba(255,255,255,0.0) 14px
    ),
    /* glow */
    radial-gradient(ellipse 140% 22px at 50% var(--localY, -999px),
      rgba(255,255,255,0.0) 0px,
      rgba(255,255,255,0.35) 10px,
      rgba(255,255,255,0.0) 30px
    ),
    /* rideau */
    repeating-linear-gradient(to bottom,
      rgba(255,255,255,0.22) 0px 2px,
      rgba(255,255,255,0.0) 2px 7px
    ),
    /* sparks */
    radial-gradient(circle at var(--sx1, 20%) calc(var(--localY, -999px) + 2px),
      rgba(255,255,255,0.95) 0 2px, rgba(255,255,255,0) 3px),
    radial-gradient(circle at var(--sx2, 40%) calc(var(--localY, -999px) + 5px),
      rgba(255,255,255,0.95) 0 2px, rgba(255,255,255,0) 3px),
    radial-gradient(circle at var(--sx3, 55%) calc(var(--localY, -999px) - 2px),
      rgba(255,255,255,0.95) 0 2px, rgba(255,255,255,0) 3px),
    radial-gradient(circle at var(--sx4, 70%) calc(var(--localY, -999px) + 1px),
      rgba(255,255,255,0.95) 0 2px, rgba(255,255,255,0) 3px),
    radial-gradient(circle at var(--sx5, 85%) calc(var(--localY, -999px) + 4px),
      rgba(255,255,255,0.95) 0 2px, rgba(255,255,255,0) 3px);

  background-size:
    100% 100%,
    100% 100%,
    100% 220px,
    100% 100%,
    100% 100%,
    100% 100%,
    100% 100%,
    100% 100%;
  background-position:
    0 0,
    0 0,
    0 var(--curtainY, 0px),
    0 0, 0 0, 0 0, 0 0, 0 0;
  background-repeat: no-repeat;

  mix-blend-mode: screen;
  filter: drop-shadow(0 0 8px rgba(255,255,255,0.35));
}

/* Masquage par alpha (images, SVG, etc.) */
.scan-reveal.is-image::before{
  -webkit-mask-image: var(--mask);
  -webkit-mask-repeat: no-repeat;
  -webkit-mask-position: center;
  -webkit-mask-size: contain;

  mask-image: var(--mask);
  mask-repeat: no-repeat;
  mask-position: center;
  mask-size: contain;
}

/* Réduction motion */
@media (prefers-reduced-motion: reduce){
  .scan-reveal::before{ display:none; }
  body.laser-reveal-running .scan-reveal{ opacity: 1; }
}
